<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

    <title>WA Barcode</title>

    <script src="bcmath-min.js" type="text/javascript"></script>
    <script src="pdf417.js" type="text/javascript"></script>

    <script>
       
       const getValue = (name) => document.querySelector(`[name="${name}"]`).value.toUpperCase();
        /**
         * Generate the barcode and display it in the UI
         */
        function generate() {
            
            // create the string to be encoded into a barcode
            var barcodeString = "@\x0A\x1C\x0DANSI 636045090001DL00310287DLDCANONE" 
                + "\x0ADCBNONE"  
                + "\x0ADCDNONE" 
                + "\x0ADBA"
                + getExpirationDate() 
                + "\x0ADCS" 
                + getValue("lastName") 
                + "\x0ADAC"
                + getValue("firstName") 
                + "\x0ADAD"
                + getValue("middleName") 
                + "\x0ADBD" 
                + getIssueDate() 
                + "\x0ADBB" 
                + getDateOfBirth() 
                + "\x0ADBC" 
                + getValue("gender") 
                + "\x0ADAY" 
                + getEyeColorCode()
                + "\x0ADAU" 
                + getHeight() 
                + "\x0ADAG" 
                + getValue("address") 
                + "\x0ADAI" 
                + getValue("city") 
                + "\x0ADAJ" 
                + getValue("state")
                + "\x0ADAK" 
                + getValue("zipCode")
                + "\x0ADAQ" 
                + getValue("licenseNumber")
                + "\x0ADCF" 
                + getDocumentDiscriminator()
                + "\x0ADCGUSA" 
                + "\x0ADDEN"
                + "\x0ADDFN"
                + "\x0ADDGN"
                + "\x0ADCJ"
                + getAuditInfo()
                + "\x0ADDAN"
                + "\x0ADDB09042018"
                + "x0ADAW"
                + getValue('weight')
                + "\x0ADDK"
                + getValue('organDonor');


            // Initialize the barcode library and set the barcode
            // to be encoded into a 4 module wide barcode
            PDF417.init(barcodeString,4);

            // Get the barcode data (an array of 0s and 1s)
            var barcode = PDF417.getBarcodeArray();

            // Set the size of the canvas to be the correct number
            // of modules wide and 3 modules high
            var bw = 6;
            var bh = 3;

            var canvas = document.createElement('canvas');
            canvas.width = bw * barcode['num_cols'];
            canvas.height = bh * barcode['num_rows'];

            // clear the barcode area and add the new canvas
            document.getElementById('barcode').innerHTML = "";
            document.getElementById('barcode').appendChild(canvas);

            var ctx = canvas.getContext('2d');

            // print barcode elements
            var y = 0;
            // for each row
            for (var r = 0; r < barcode['num_rows']; ++r) {
                var x = 0;
                // for each column
                for (var c = 0; c < barcode['num_cols']; ++c) {
                    if (barcode['bcode'][r][c] == 1) {
                        ctx.fillRect(x, y, bw, bh);
                    }
                    x += bw;
                }
                y += bh;
            }
        }

        function getHeight(){
            return '0' + ((getValue('heightFeet') * 12) + getValue('heightInches')) + ' in'; 
        }

        function getExpirationDate() {
            return '' + getValue('yearExpired') + formatDate(getValue('monthExpired')) + formatDate(getValue('dayExpired'));
        }

        function getIssueDate() {
            return '' + getValue('yearIssued') + formatDate(getValue('monthIssued')) + formatDate(getValue('dayIssued'));
         }

         function getDateOfBirth(){
            return '' + getValue('yearOfBirth') + formatDate(getValue('monthOfBirth')) + formatDate(getValue('dayOfBirth'));
         }

         function getEyeColorCode() {
            let color = getValue('eyeColor');
            switch (color.toLowerCase()) {
                case 'brown': return "BRN";
                case 'blue': return "BLU";
                case 'green': return "GRN";
                case 'hazel': return "HZL";
                case 'grey': return "GRY";
                case 'amber': return "AMB";
                default: return "";  // default case to handle unexpected values
            }
        }
        
        function getAuditInfo(){
            let day = formatDate(getValue('dayIssued'));
            let month = formatDate(getValue('monthIssued'));
            let year = ('' + getValue('yearIssued')).substring(2,3);
            return '' + day + month + year;
        }

        function getDocumentDiscriminator() {
            return getValue('licenseNumber') + 'D' + getAuditInfo();
        }

        function formatDate(myNumber) {
            return ("0" + myNumber).slice(-2);
        }
        
    </script>

</head>

<body>
    <h1>RobiWanKenobi's WA ID Barcode (PDF417) Generator:</h1>
    <hr/><br/>
	<div id="barcode">[Barcode Will Load Here]</div>
	<br/><hr/>
    <h2>Double check all info before submitting to ensure accurate results!</h2>
    <h2>Leave fields such as "Driving Class", "Endorsements, or "Restriction Codes" blank unless they apply to you.</h2>
    <br />
    <button type="submit" onclick="generate();">Generate</button>
    <br />
    <br /> Driver License / ID Card Number:
    <input name="licenseNumber" value="WDLABC123EFG"></input>
    <br />
    <br /> First Name:
    <input name="firstName" value="SELENA"></input>
    <br />
    <br /> Middle Name:
    <input name="middleName" value="NICOLE"></input>
    <br />
    <br /> Last Name:
    <input name="lastName" value="JOHNSON"></input>
    <br />
    <br /> Address:
    <input name="address" value="14300 NE 95TH CIR"></input>
    <br />
    <br /> City:
    <input name="city" value="VANCOUVER"></input>
    <br />
    <br /> Full Zipcode:
    <input name="zipCode" value="986823095"></input>
    <br />
    <br /> State:
    <input name="state" value="WA"></input>
    <br />
    <br /> Height (Ft.):
    <input type="number" name="heightFeet" min="4" max="7" value="5"></input>
    <br />
    <br /> Height (In.):
    <input type="number" name="heightInches" min="0" max="11" value="5"></input>
    <br />
    <br /> Weight (lb.):
    <input type="number" name="weight" min="100" max="500" value="170"></input>
    <br />
    <br /> Year (Birth):
    <input type="number" name="yearOfBirth" min="1900" max="2100" value="1990"></input>
    <br />
    <br /> Month (Birth):
    <input type="number" name="monthOfBirth" min="1" max="12" value="07"></input>
    <br />
    <br /> Day (Birth):
    <input type="number" name="dayOfBirth" min="1" max="31" value="04"></input>
    <br />
    <br /> Year (Issued):
    <input type="number" name="yearIssued" min="1900" max="2100" value="2020"></input>
    <br />
    <br /> Month (Issued):
    <input type="number" name="monthIssued" min="1" max="12" value="07"></input>
    <br />
    <br /> Day (Issued):
    <input type="number" name="dayIssued" min="1" max="31" value="01"></input>
    <br />
    <br />Year (Expired):
    <input type="number" name="yearExpired" min="2022" max ="2100" value="2028"></input>
    <br />
    <br />Month (Expired) *SHOULD BE SAME AS BIRTHMONTH IN MOST CASES*:
    <input type="number" name="monthExpired" min="1" max="12" value="07"></input>
    <br />
    <br />Day (Expired) *SHOULD BE SAME AS DAY BORN IN MOST CASES*:
    <input type="number" name="dayExpired" min="1" max="31" value="04"></input>
    <br />
    <br /> Gender:
    <select name="gender" value="2">
        <option value="1">M</option>
        <option value="2">F</option>
    </select>
    <br />
    <br /> Organ Donor:
    <select name="organDonor" value="1">
        <option value="2">No</option>
        <option value="1">Yes</option>
    </select>
    <br />
    <br /> Eye Color Code:
    <select name="eyeColor" value="Brown">
        <option value="brown">Brown</option>
        <option value="blue">Blue</option>
        <option value="green">Green</option>
        <option value="hazel">Hazel</option>
        <option value="grey">Grey</option>
        <option value="amber">Amber</option>
    </select>
    <br />
    <br /> Hair Color Code:
    <input name="hair" value="brown"></input> (unused in some states)
    <br />
    <br />

    <button type="submit" onclick="generate();">Generate</button>

</body>

</html>
